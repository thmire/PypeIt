
Version 1.16.0
==============

Installation Changes
--------------------

Dependency Changes
------------------

- PypeIt now only supports python versions >=3.10, numpy>=1.23, and ginga>=5.1.0

- sphinx-rtd-theme updated to 2.0, along with relevant dependencies

Functionality/Performance Improvements and Additions
----------------------------------------------------

- Allow the selection of a secondary filter option  for all spectrographs that
  need it; see new ``filter2`` parameter.

- When dealing with `bkg_redux` reduction (i.e., A-B), a sky model (called
  `bkg_redux_skymodel`) is generated using the A frame, while the existing
  `skymodel` is generated using the A-B frame.  This allows to have an actual 1D
  extracted sky spectrum and to perform the flexure correction for `bkg_redux`
  reduction.

- Various improvements in the flexure correction and added the possibility to
  use a modeled archive sky spectrum generated with
  `pypeit.wavemodel.nearIR_modelsky()` to perform the flexure correction.

- Updated the list of available CALSPEC standard star with the latest version
  from the CALSPEC website.

Instrument-specific Updates
---------------------------

- Improvements for SOAR/Goodman
    - Added ``WAVMODE`` header keyword to ``configuration keys`` and
      ``raw header cards``.

- Added example of improved wavelength solution for GEMINI/GMOS

- Introduces reduction pipeline for high-resolution modes of Keck/NIRSPEC

- Expanded the template for `shane_kast_red` and the 1200/5000 grating

- Fixed and improved the wavelength template `magellan_fire_long`

- Updated Gemini/GMOS-S with the new detector parameters for the Hamamatsu CCDs
  replaced on 2023-12-14

Script Changes
--------------

- When interactively fitting a single peak with the `pypeit_identify` script
  (i.e. using the `i` command), line centroids can now be both updated and added
  interactively.

Datamodel Changes
-----------------

- `Spec2DObj` now has an additional image, called `bkg_redux_skymodel`, which is
  the "actual" sky model in the case of `bkg_redux` reduction (i.e., dithered
  observations). This image is not generated if `bkg_redux` is False. In any
  case, the `skymodel` is always generated.

Bug Fixes
---------

- The subpixel algorithm used to resample datacubes that are generated by
  `pypeit_coadd_datacube` produced error cubes that were not properly
  propagating the noise. The error cubes of the NGP algorithm were unaffected.
  The error cubes are now regularly inspected with vet tests to ensure the error
  cubes are reliable.

- Fix a bug (introduced in a recent PR) that was generating an error if less
  than 2 spec1d files were used with `pypeit_coadd_1dspec`. Now the script can
  be run with only one file (as it was before).

- Allow `spec_flex_shift()` to take as input either the name of an archive sky
  spectrum or directly a sky spectrum. This fixes a bug in the flexure
  correction for SlicerIFU.

- The `--show` option of the `pypeit_coadd_1dspec` script was not properly
  displaying the x-axis of the plot. Both the top and bottom panels now scale
  together.

- Fix a bug in `pypeit_sensfunc` that was causing the script to crash because
  `par['fluxcalib']` was not being passed to `sensfunc.SensFunc.get_instance()`.

